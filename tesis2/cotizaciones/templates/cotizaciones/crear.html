{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Nueva Cotizaci√≥n - Sistema de Cotizaciones</title>
  <link rel="stylesheet" href="{% static 'cotizaciones/css/style.css' %}">
</head>
<body>
  <!-- Header -->
  <div class="topbar">
    <div class="logo">
      üìä Sistema de Cotizaciones
      <span class="badge">Nueva Cotizaci√≥n</span>
    </div>
    <div class="spacer"></div>
    <div class="user-menu">
      <a href="{% url 'cotizaciones:dashboard' %}">‚Üê Dashboard</a>
      <a href="{% url 'cotizaciones:lista' %}">Lista</a>
    </div>
  </div>

  <div class="container">
    <!-- Alerts -->
    {% if messages %}
      {% for message in messages %}
        <div class="alert {{ message.tags }}">
          {{ message }}
        </div>
      {% endfor %}
    {% endif %}

    <!-- Actions -->
    <div class="actions">
      <div class="actions-left">
        <h1 style="margin: 0; color: var(--azul-700);">Nueva Cotizaci√≥n</h1>
      </div>
      <div class="actions-right">
        <button type="submit" form="cotizacion-form" class="btn success">
          ‚úÖ Crear Cotizaci√≥n
        </button>
        <a href="{% url 'cotizaciones:lista' %}" class="btn secondary">
          ‚ùå Cancelar
        </a>
      </div>
    </div>

    <!-- Formulario -->
    <div class="card">
      <h3>üìã Informaci√≥n B√°sica de la Cotizaci√≥n</h3>
      
      <form method="post" id="cotizacion-form">
        {% csrf_token %}
        
        <div class="form-row">
          <div class="form-group">
            <label for="{{ form.cliente.id_for_label }}">Cliente *</label>
            {{ form.cliente }}
            {% if form.cliente.errors %}
              <span style="color: var(--rojo-600); font-size: 0.85rem;">
                {{ form.cliente.errors.0 }}
              </span>
            {% endif %}
          </div>
          <div class="form-group">
            <label for="{{ form.tipo_trabajo.id_for_label }}">Tipo de Trabajo *</label>
            {{ form.tipo_trabajo }}
            {% if form.tipo_trabajo.errors %}
              <span style="color: var(--rojo-600); font-size: 0.85rem;">
                {{ form.tipo_trabajo.errors.0 }}
              </span>
            {% endif %}
          </div>
        </div>

        <div class="form-group">
          <label for="{{ form.referencia.id_for_label }}">Referencia del Trabajo *</label>
          {{ form.referencia }}
          <small style="color: var(--gris-600);">
            Describe brevemente el trabajo a realizar (ej: "INSTALACI√ìN DE EQUIPO DE BOMBEO PARA POZO PROFUNDO")
          </small>
          {% if form.referencia.errors %}
            <span style="color: var(--rojo-600); font-size: 0.85rem;">
              {{ form.referencia.errors.0 }}
            </span>
          {% endif %}
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="{{ form.lugar.id_for_label }}">Lugar del Trabajo *</label>
            {{ form.lugar }}
            <small style="color: var(--gris-600);">
              Ubicaci√≥n donde se realizar√° el trabajo (ej: "PUERTO VARAS", "BUENA VENTURA")
            </small>
            {% if form.lugar.errors %}
              <span style="color: var(--rojo-600); font-size: 0.85rem;">
                {{ form.lugar.errors.0 }}
              </span>
            {% endif %}
          </div>
          <div class="form-group">
            <label for="{{ form.fecha_vencimiento.id_for_label }}">Fecha de Vencimiento</label>
            {{ form.fecha_vencimiento }}
            <small style="color: var(--gris-600);">
              Fecha hasta cuando es v√°lida la cotizaci√≥n (opcional)
            </small>
            {% if form.fecha_vencimiento.errors %}
              <span style="color: var(--rojo-600); font-size: 0.85rem;">
                {{ form.fecha_vencimiento.errors.0 }}
              </span>
            {% endif %}
          </div>
        </div>

        <div class="form-group">
          <label for="{{ form.observaciones.id_for_label }}">Observaciones</label>
          {{ form.observaciones }}
          <small style="color: var(--gris-600);">
            Notas adicionales o condiciones especiales (opcional)
          </small>
          {% if form.observaciones.errors %}
            <span style="color: var(--rojo-600); font-size: 0.85rem;">
              {{ form.observaciones.errors.0 }}
            </span>
          {% endif %}
        </div>
      </form>
    </div>

    <!-- Informaci√≥n de ayuda -->
    <div class="card">
      <h3>üí° Informaci√≥n Importante</h3>
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 16px;">
        <div>
          <h4 style="color: var(--azul-600); margin: 0 0 8px;">üìã Despu√©s de Crear</h4>
          <p style="margin: 0; color: var(--gris-600); font-size: 0.9rem;">
            Una vez creada la cotizaci√≥n, podr√°s agregar servicios, materiales y mano de obra en el modo de edici√≥n.
          </p>
        </div>
        <div>
          <h4 style="color: var(--azul-600); margin: 0 0 8px;">üîß Servicios Autom√°ticos</h4>
          <p style="margin: 0; color: var(--gris-600); font-size: 0.9rem;">
            El sistema tiene cat√°logos parametrizables para bombas, tableros, estanques y otros servicios.
          </p>
        </div>
        <div>
          <h4 style="color: var(--azul-600); margin: 0 0 8px;">üí∞ C√°lculos Autom√°ticos</h4>
          <p style="margin: 0; color: var(--gris-600); font-size: 0.9rem;">
            Los totales, IVA y valores finales se calculan autom√°ticamente al agregar items.
          </p>
        </div>
      </div>
    </div>

    <!-- Accesos r√°pidos -->
    <div class="card">
      <h3>üöÄ Accesos R√°pidos</h3>
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px;">
        <a href="{% url 'cotizaciones:gestionar_clientes' %}" class="btn secondary">
          üë• Nuevo Cliente
        </a>
        <a href="{% url 'cotizaciones:gestionar_servicios' %}" class="btn secondary">
          üîß Ver Servicios
        </a>
        <a href="{% url 'cotizaciones:gestionar_materiales' %}" class="btn secondary">
          üì¶ Ver Materiales
        </a>
        <a href="{% url 'cotizaciones:lista' %}" class="btn secondary">
          üìÑ Ver Cotizaciones
        </a>
      </div>
    </div>
  </div>

  <script src="{% static 'cotizaciones/js/main.js' %}"></script>
  <script>
    // Validaci√≥n del formulario en tiempo real
    document.addEventListener('DOMContentLoaded', function() {
      const form = document.getElementById('cotizacion-form');
      const requeridos = form.querySelectorAll('[required]');
      
      requeridos.forEach(campo => {
        campo.addEventListener('blur', function() {
          if (!this.value.trim()) {
            this.style.borderColor = 'var(--rojo-600)';
          } else {
            this.style.borderColor = 'var(--verde-600)';
          }
        });
      });
      
      // Validaci√≥n al enviar
      form.addEventListener('submit', function(e) {
        let esValido = true;
        
        requeridos.forEach(campo => {
          if (!campo.value.trim()) {
            campo.style.borderColor = 'var(--rojo-600)';
            esValido = false;
          }
        });
        
        if (!esValido) {
          e.preventDefault();
          alert('Por favor completa todos los campos requeridos');
        }
      });
    });
  </script>
</body>
</html>